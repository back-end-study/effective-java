# item75 예외의 상세 메시지에 실패 관련 정보를 담으라

예외를 잡지 못해 프로그램이 실패하면 스택 추적을 출력한다. 스택 추적은 예외 객체의 toString 메서드를 호출해 얻는 문자열로, 보통은 예외의 클래스 이름 뒤에 상세 메시지가 붙는 형태다.

사후 분석을 위해 실패 순간의 상황을 정확히 포착해 예외의 상세 메시지에 담아야 한다.
실패 순간을 포착하려면 발생한 예외에 관여된 모든 매개변수와 필드의 값을 실패 메시지에 담아야 한다.
> 보안과 관련한 정보는 주의해서 다뤄야 한다. 문제를 진단하고 해결하는 과정에서 스택 추적 정보를 많은 사람이 볼 수 있으므로 상세 메시지에 비밀번호나 암호 키 같은 정보까지 담아서는 안된다.

스택 추적에는 예외가 발생한 파일 이름과 줄번호는 물론 스택에서 호출한 다른 메서드들의 파일 이름과 줄번호까지 정확히 기록되어 있는게 보통이다. 문서와 소스코드에서 얻을 수 있는 정보는 남길 필요가 없다.

예외의 상세 메시지와 최종 사용자에게 보여줄 오류 메시지를 혼동해서는 안 된다. 최종 사용자에게는 친절한 안내 메시지를 보여줘야 하는 반면, 예외 메시지는 가독성보다는 담긴 내용이 훨씬 중요하다. 예외 메시지의 주 소비층은 문제를 분석해야 할 프로그래와 SRE 엔지니어이기 때문이다.

실패를 적절히 포착하려면 필요한 정보를 예외 생성자에서 모두 받아서 상세 메시지까지 미리 생성해놓는 방법도 괜찮다. 상세 메시지를 만들어내는 코드를 예외클래스 안으로 모아주는 효과도 있어, 클래스 사용자가 메시지를 만드는 작업을 중복하지 않아도 된다.
```java
/**  
 * IndexOutOfBoundsException을 생성한다.  
 * @param lowerBound 인덱스의 최솟값  
 * @param upperBound 인덱스의 최댓값 + 1  
 * @param index 인덱스의 실젯값  
 */  
public IndexOutOfBoundsException(int lowerBound, int upperBound, int index) {  
    // 실패를 포착하는 상세 메시지를 생성한다.  
    super(String.format("최솟값: %d, 최댓값: %d, 인덱스: %d", lowerBound, upperBound, index));  
    // 프로그램에서 이용할 수 있도록 실패 정보를 저장해둔다.  
    this.lowerBound = lowerBound;  
    this.upperBound = upperBound;  
    this.index = index;  
}
```
자바9에서는 IndexOutOfBoundsException에 정수 인덱스 값을 받는 생성자가 추가되었다. 최솟값과 최댓값까지 받지는 않는다.

예외는 실패와 관련한 정보를 얻을 수 있는 접근자 메서드를 적절히 제공하는 것이 좋다. 포착한 실패 정보는 예외 상황을 복구하는데 유용할 수 있으므로 접근자 메서드는 비검사 예외보다 검사 예외에서 더 빛을 발한다. 비검사 예외의 상세 정보를 접근하길 바라는 프로그래머는 드물 것이다. 하지만 'toString이 반환한 값에 포함된 정보를 얻어올 수 있는 API를 제공하자'는 원칙을 따른다는 관점에서, 비검사 예외라도 상세 정보를 알려주는 접근자 메서드를 제공하길 권한다.
